{{/*
Purpose: Homepage for shawnyeager.com - The Gallery

Features:
- Bio section from index.md content (includes CTA via shortcode)
- Featured or latest essay display
- Podcast feature section
- Recent essays listing (5 most recent)
- Topic browsing

Logic:
- Shows featured essay if one has featured: true in frontmatter
- Otherwise shows most recent essay
- Filters drafts in production
- Topic list via topic-list.html partial

Important Notes:
- Overrides theme default index.html
- Bio content and CTA come from /content/_index.md
*/}}

{{ define "main" }}
    <!-- Bio -->
    <div class="site-intro">
        {{ with .Params.headline }}<h1 class="display-title">{{ . | safeHTML }}</h1>{{ end }}
        {{ with .Params.tagline }}<p class="intro-tagline">{{ . }}</p>{{ end }}
        {{ with .Params.sectors }}<p class="intro-sectors">{{ . }}</p>{{ end }}
        <div class="intro-body">
            {{ .Content | safeHTML }}
        </div>
    </div>

    <!-- Featured or Latest Essay -->
    {{ $posts := where .Site.RegularPages "Type" "essays" }}
    {{ if not hugo.IsServer }}
    {{ $posts = where $posts "Draft" false }}
    {{ end }}
    {{ $featuredPost := where $posts "Params.featured" true }}
    {{ $latestPost := index $posts 0 }}
    {{ $isFeatured := false }}
    {{ if $featuredPost }}
        {{ $latestPost = index $featuredPost 0 }}
        {{ $isFeatured = true }}
    {{ end }}
    {{ with $latestPost }}
    <h2 class="essay-section-header">{{ if $isFeatured }}Featured Essay{{ else }}Latest Essay{{ end }}</h2>
    <article class="latest-essay">
        <header>
            <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
        </header>
        <p>{{ with .Params.summary }}{{ . | safeHTML }}{{ else }}{{ .Summary }}{{ end }}</p>
        <footer>
            {{- partial "links/action.html" (dict "url" .RelPermalink "text" "Read more" "event" $.Site.Params.plausible_events.essay_cta) -}}
        </footer>
    </article>
    {{ end }}

    <!-- Recent Essays -->
      {{/* Exclude featured essay from list to avoid duplication */}}
      {{ $recentPosts := where $posts "Params.featured" "!=" true }}
      {{/* If no featured, skip the first (already shown as Latest) */}}
      {{ if not $isFeatured }}
          {{ $recentPosts = after 1 $posts }}
      {{ end }}
      {{ if $recentPosts }}
      <section class="recent-essays">
          <h2 class="section-label-small">Recent Essays</h2>
         {{ range first 5 $recentPosts }}
         <article class="essay-item">
             <a href="{{ .RelPermalink }}">
                 <time datetime="{{ .Date.Format "2006-01-02" }}" class="essay-date">{{ .Date.Format "2006 Â· 01" }}</time>
                 <span class="essay-title">{{ .Title }}</span>
             </a>
         </article>
         {{ end }}
         <div class="all-essays">{{- partial "links/action.html" (dict "url" ("essays" | relURL) "text" "All essays" "event" .Site.Params.plausible_events.all_essays) -}}</div>
     </section>
      {{ else }}
      <section class="recent-essays">
          <h2 class="section-label-small">Recent Essays</h2>
          <p>No essays published yet.</p>
      </section>
      {{ end }}
{{ end }}
